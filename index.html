<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faucet List</title>
    <style>
        .button,
        .button-primary,
        .button-secondary {
            display: inline-block;
            text-decoration: none;
            font-size: 13px;
            line-height: 26px;
            height: 28px;
            margin: 0;
            padding: 0 10px 1px;
            cursor: pointer;
            border-width: 1px;
            border-style: solid;
            -webkit-appearance: none;
            -webkit-border-radius: 3px;
            border-radius: 3px;
            white-space: nowrap;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        
        .button,
        .button-secondary {
            color: #555;
            border-color: #cccccc;
            background: #f7f7f7;
            -webkit-box-shadow: inset 0 1px 0 #fff, 0 1px 0 rgba(0,0,0,.08);
            box-shadow: inset 0 1px 0 #fff, 0 1px 0 rgba(0,0,0,.08);
            vertical-align: top;
        }
        
        p .button {
            vertical-align: baseline;
        }
        
        .button:hover,
        .button-secondary:hover,
        .button:focus,
        .button-secondary:focus {
            background: #fafafa;
            border-color: #999;
            color: #222;
        }
        
        .button:focus,
        .button-secondary:focus {
            -webkit-box-shadow: 1px 1px 1px rgba(0,0,0,.2);
            box-shadow: 1px 1px 1px rgba(0,0,0,.2);
        }
        
        .button:active,
        .button-secondary:active {
            background: #eee;
            border-color: #999;
            color: #333;
            -webkit-box-shadow: inset 0 2px 5px -3px rgba( 0, 0, 0, 0.5 );
            box-shadow: inset 0 2px 5px -3px rgba( 0, 0, 0, 0.5 );
        }
        
        .button-primary {
            background: #2ea2cc;
            border-color: #0074a2;
            -webkit-box-shadow: inset 0 1px 0 rgba(120,200,230,0.5), 0 1px 0 rgba(0,0,0,.15);
            box-shadow: inset 0 1px 0 rgba(120,200,230,0.5), 0 1px 0 rgba(0,0,0,.15);
            color: #fff;
            text-decoration: none;
        }
        
        .button-primary:hover,
        .button-primary:focus {
            background: #1e8cbe;
            border-color: #0074a2;
            -webkit-box-shadow: inset 0 1px 0 rgba(120,200,230,0.6);
            box-shadow: inset 0 1px 0 rgba(120,200,230,0.6);
            color: #fff;
        }
        
        .button-primary:focus {
            border-color: #0e3950;
            -webkit-box-shadow: inset 0 1px 0 rgba(120,200,230,0.6), 1px 1px 2px rgba(0,0,0,0.4);
            box-shadow: inset 0 1px 0 rgba(120,200,230,0.6), 1px 1px 2px rgba(0,0,0,0.4);
        }
        
        .button-primary:active {
            background: #1b7aa6;
            border-color: #005684;
            color: rgba(255,255,255,0.95);
            -webkit-box-shadow: inset 0 1px 0 rgba(0,0,0,0.1);
            box-shadow: inset 0 1px 0 rgba(0,0,0,0.1);
            vertical-align: top;
        }
        
        .progressBar {
          width: 200px;
          margin: 10px auto;
          height: 22px;
          background-color: #28a745;
          color: white;
        }
        
        .progressBar div {
          height: 100%;
          line-height: 22px;
          width: 0;
          background-color: #17a2b8;
          box-sizing: border-box;
          color: white;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function progress(timeleft, timetotal, $element) {
            var progressBarWidth = timeleft * $element.width() / timetotal;
            $element.find('div').animate({ width: progressBarWidth }, timeleft == timetotal ? 0 : 1000, 'linear').html("");
            if(timeleft > 0) {
                setTimeout(function() {
                    progress(timeleft - 1, timetotal, $element);
                }, 1000);
            } else {
                $element.find('div').html("Ready");
            }
        };
    </script>
</head>
<body>
    <h1>Add New Faucet</h1>
    <form id="add-faucet-form">
        <table>
            <tr>
                <td>Name</td>
                <td><input type="text" id="faucet-name" required></td>
                <td>Timer (in minutes)</td>
                <td><input type="number" id="faucet-timer" required></td>
            </tr>
            <tr>
                <td>Url</td>
                <td><input type="text" id="faucet-url" required></td>
                <td colspan="2"><button type="submit" class="button-primary">Submit</button></td>
            </tr>
        </table>
    </form>

    <h1>All Faucets</h1>
    <table id="faucet-table" width="100%" border="1" style="border-collapse: collapse;">
        <thead>
            <tr>
                <th>Name</th>
                <th>Url</th>
                <th>Timer</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <!-- Faucet rows will be inserted here by JavaScript -->
        </tbody>
    </table>

    <script>
        $(document).ready(function() {
            const FaucetStore = {
                getFaucets: function() {
                    return JSON.parse(localStorage.getItem('faucets')) || [];
                },
                saveFaucets: function(faucets) {
                    localStorage.setItem('faucets', JSON.stringify(faucets));
                }
            };

            function renderFaucets() {
                const faucets = FaucetStore.getFaucets();
                const tableBody = $('#faucet-table tbody');
                tableBody.empty();

                if (faucets.length === 0) {
                    tableBody.append('<tr><td colspan="4">No record found</td></tr>');
                    return;
                }

                faucets.forEach((faucet, index) => {
                    const now = Math.floor(Date.now() / 1000);
                    const lastClaim = faucet.last_claim || 0;
                    const timerInSeconds = faucet.timer * 60;
                    const diff = now - lastClaim;
                    const timeleft = Math.max(0, timerInSeconds - diff);

                    const row = `
                        <tr>
                            <td>${faucet.name}</td>
                            <td>${faucet.url}</td>
                            <td>
                                <center><span class="text-muted">${faucet.timer} min</span></center>
                                <div id="timeBar_all_${faucet.id}" class="progressBar">
                                    <div>Ready</div>
                                </div>
                            </td>
                            <td>
                                <button class="button-secondary delete-faucet" data-id="${faucet.id}">Delete</button>
                                <a href="${faucet.url}" target="_blank" class="button-primary claim-faucet" data-id="${faucet.id}">Claim</a>
                            </td>
                        </tr>
                    `;
                    tableBody.append(row);

                    if (timeleft > 0) {
                        progress(timeleft, timerInSeconds, $('#timeBar_all_' + faucet.id));
                    }
                });
            }

            $('#add-faucet-form').on('submit', function(e) {
                e.preventDefault();
                const faucets = FaucetStore.getFaucets();
                const newFaucet = {
                    id: Date.now(),
                    name: $('#faucet-name').val(),
                    url: $('#faucet-url').val(),
                    timer: parseInt($('#faucet-timer').val()),
                    last_claim: 0
                };
                faucets.push(newFaucet);
                FaucetStore.saveFaucets(faucets);
                this.reset();
                renderFaucets();
            });

            $('#faucet-table').on('click', '.delete-faucet', function() {
                if (!confirm('Are you sure you want to delete this faucet?')) {
                    return;
                }
                const faucetId = $(this).data('id');
                let faucets = FaucetStore.getFaucets();
                faucets = faucets.filter(f => f.id !== faucetId);
                FaucetStore.saveFaucets(faucets);
                renderFaucets();
            });

            $('#faucet-table').on('click', '.claim-faucet', function() {
                const faucetId = $(this).data('id');
                let faucets = FaucetStore.getFaucets();
                const faucet = faucets.find(f => f.id === faucetId);
                if (faucet) {
                    faucet.last_claim = Math.floor(Date.now() / 1000);
                    FaucetStore.saveFaucets(faucets);
                    const timerInSeconds = faucet.timer * 60;
                    progress(timerInSeconds, timerInSeconds, $('#timeBar_all_' + faucet.id));
                }
            });

            renderFaucets();
        });
    </script>
</body>
</html>
